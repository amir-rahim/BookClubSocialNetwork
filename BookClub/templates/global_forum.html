{% extends 'base_content.html' %}

{% block page_title %}
Global Forum
{% endblock page_title %}

{% block page_subtitle %}
This is the Global Forum, you can look at what our members are posting about!
{% endblock page_subtitle %}

{% block content %}

    <div class="columns">

        <div class="column is-3">
            <aside class="menu is-hidden-mobile" style="padding-left: 15px;">

                <p class="menu-label">Clubs</p>

                <ul class="menu-list">
                    <li><a class="is-active"><b>Available Clubs</b></a></li>
                    <li><a href="{% url 'my_club_memberships' %}">Memberships</a></li>
                    <li><a href="{% url 'create_club' %}">Create Club</a></li>
                </ul>

                 <p class="menu-label">Useful Links</p>

                <ul class="menu-list">
                    <li><a href="{% url 'user_dashboard' %}">User Profile</a></li>
                    <li><a>Library</a></li>
                    <li><a>Forum</a></li>
                </ul>

            </aside>
        </div>

        <div class="column is-9">

            <div class="columns">
                <div class="column is-10">
                    <nav class="breadcrumb" aria-label="breadcrumbs" style="padding-left: 10px;">
                        <ul>
                            <li><a href="{% url 'home' %}">Home</a></li>
                            <li><a href="{% url 'global_forum' %}">Forum</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="column is-2">
                    <button class="button is-link js-modal-trigger is-fullwidth is-rounded" data-target="modal-create-post">
                        Create Post
                    </button>
                </div>

            </div>

            <section class="hero is-link welcome is-small" style="margin: 10px 0px;">
                <div class="hero-body">
                    <nav class="level">
                        <div class="level-item has-text-centered">
                            <div>
                                <p class="heading">Posts</p>
                                <p class="title">{{posts.count}}</p>
                            </div>
                        </div>
                        <div class="level-item has-text-centered">
                            <div>
                                <p class="heading">Replies</p>
                                <p class="title">{{replies}}</p>
                            </div>
                        </div>
                        <div class="level-item has-text-centered">
                            <div>
                                <p class="heading">Votes Cast</p>
                                <p class="title">{{votes}}</p>
                            </div>
                        </div>
                        <div class="level-item has-text-centered">
                            <div>
                                <p class="heading">Users</p>
                                <p class="title">{{usercount}}</p>
                            </div>
                        </div>
                    </nav>
                </div>
            </section>

            <hr class="solid">
            {%for post in posts%}
            <br>
            <div class="card">
                <header class="card-header">
                    <div class="card-header-title">
                        <p class="subtitle"><b>{{post.title}}</b></p>
                    </div>

                    <div class="card-header-icon">
                        <button class="button is-primary is-rounded" aria-label="Upvote">
                            <span class="icon">
                                <i class="fa-solid fa-arrow-up"></i>
                            </span>
                        </button>
                        <button class="button is-danger is-rounded" aria-label="Downvote">
                            <span class="icon">
                                <i class="fa-solid fa-arrow-down"></i>
                            </span>
                        </button>

                        <button class="button is-rounded" title="Disabled button" disabled>{{post.rating}}</button>
                    </div>

                </header>

                <div class="card-content">
                    <div class="content">
                        <span class="has-text-grey">
                        {{post.content |truncatechars:240}}    
                        </span>
                    </div>
                </div>

                <footer class="card-footer">
                    <p class="card-footer-item"><span class="is-small has-text-grey-light">Posted by: {{post.creator}}</span></p>
                    <p class="card-footer-item has-text-grey-light">{{ post.created_on | timesince }} ago</p>
                    <a href="#" class="card-footer-item">
                        {% if post.comments.count > 0 %} 
                            See {{ post.comments.count }} comments
                        {% else %} 
                            Be the first to comment!
                        {% endif %}</a>
                </footer>
            </div>

            {%endfor%}

            <br>

            {% include 'partials/pagination.html' %}

            <div id="modal-create-post" class="modal">
                <div class="modal-background"></div>

                <div class="modal-content">
                    <div class="card">
                        <div class="card-header">
                            <button class="card-header-icon" aria-label="more options">
                                <span class="icon">
                                    <i class="card-header-icon fa-solid fa-pen-clip"></i>
                                </span>
                            </button>
                            <p class="card-header-title">Create Discussion Post</p>
                        </div>
                        <div class="card-content">
                            <div class="container">
                                <form method="post">
                                    {% csrf_token %}
                                    {% include 'partials/bulma_form.html' with form=form %}
                                    <input type="submit" value="Make Post" class="button is-link">
                                </form>
                            </div>
                        </div>
                        <footer class="card-footer">
                            <a href="#" class="card-footer-item">Clear</a>
                            <a href="#" class="card-footer-item">Post</a>
                        </footer>
                    </div>
                </div>

                <button class="modal-close is-large" aria-label="close"></button>
            </div>

        </div>

    </div>

    <script>

        document.addEventListener('DOMContentLoaded', () => {
          // Functions to open and close a modal
          function openModal($el) {
            $el.classList.add('is-active');
          }

          function closeModal($el) {
            $el.classList.remove('is-active');
          }

          function closeAllModals() {
            (document.querySelectorAll('.modal') || []).forEach(($modal) => {
              closeModal($modal);
            });
          }

          // Add a click event on buttons to open a specific modal
          (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
            const modal = $trigger.dataset.target;
            const $target = document.getElementById(modal);
            console.log($target);

            $trigger.addEventListener('click', () => {
              openModal($target);
            });
          });

          // Add a click event on various child elements to close the parent modal
          (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
            const $target = $close.closest('.modal');

            $close.addEventListener('click', () => {
              closeModal($target);
            });
          });

          // Add a keyboard event to close all modals
          document.addEventListener('keydown', (event) => {
            const e = event || window.event;

            if (e.keyCode === 27) { // Escape key
              closeAllModals();
            }
          });
        });

    </script>

{% endblock %}
